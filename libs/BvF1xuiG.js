import{r as e}from"./3gHN-mVt.js";import{r}from"./Bqj1olYq.js";var t,i={},n={};function s(){return t||(t=1,Object.defineProperty(n,"__esModule",{value:!0}),n.excelBOM=n.defaultCsv2JsonOptions=n.defaultJson2CsvOptions=n.errors=void 0,n.errors={optionsRequired:"Options were not passed and are required.",json2csv:{cannotCallOn:"Cannot call json2csv on",dataCheckFailure:"Data provided was not an array of documents.",notSameSchema:"Not all documents have the same schema."},csv2json:{cannotCallOn:"Cannot call csv2json on",dataCheckFailure:"CSV is not a string."}},n.defaultJson2CsvOptions={arrayIndexesAsKeys:!1,checkSchemaDifferences:!1,delimiter:{field:",",wrap:'"',eol:"\n"},emptyFieldValue:void 0,escapeHeaderNestedDots:!0,excelBOM:!1,excludeKeys:[],expandNestedObjects:!0,expandArrayObjects:!1,prependHeader:!0,preventCsvInjection:!1,sortHeader:!1,trimFieldValues:!1,trimHeaderFields:!1,unwindArrays:!1,useDateIso8601Format:!1,useLocaleFormat:!1,wrapBooleans:!1,fieldTitleMap:Object.create({})},n.defaultCsv2JsonOptions={delimiter:{field:",",wrap:'"',eol:"\n"},excelBOM:!1,preventCsvInjection:!1,trimFieldValues:!1,trimHeaderFields:!1},n.excelBOM="\ufeff"),n}var a,l,o={},u={};function d(){if(a)return u;a=1,Object.defineProperty(u,"__esModule",{value:!0}),u.isInvalid=u.flatten=u.unique=u.arrayDifference=u.isError=u.isUndefined=u.isNull=u.isObject=u.isString=u.isNumber=u.unwind=u.getNCharacters=u.removeEmptyFields=u.isEmptyField=u.computeSchemaDifferences=u.isDateRepresentation=u.isStringRepresentation=u.deepCopy=u.validate=u.buildC2JOptions=u.buildJ2COptions=void 0;const r=e(),t=s(),i=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/,n=1e5;function l(e){return JSON.parse(JSON.stringify(e))}function o(e){return c(e)||d(e)||""===e}function d(e){return null===e}function c(e){return void 0===e}function f(e,r){return e.filter((e=>!r.includes(e)))}return u.buildJ2COptions=function(e){var r,i,n;return{...t.defaultJson2CsvOptions,...e,delimiter:{field:(null==(r=null==e?void 0:e.delimiter)?void 0:r.field)??t.defaultJson2CsvOptions.delimiter.field,wrap:(null==(i=null==e?void 0:e.delimiter)?void 0:i.wrap)||t.defaultJson2CsvOptions.delimiter.wrap,eol:(null==(n=null==e?void 0:e.delimiter)?void 0:n.eol)||t.defaultJson2CsvOptions.delimiter.eol},fieldTitleMap:(null==e?void 0:e.fieldTitleMap)||Object.create({})}},u.buildC2JOptions=function(e){var r,i,n;return{...t.defaultCsv2JsonOptions,...e,delimiter:{field:(null==(r=null==e?void 0:e.delimiter)?void 0:r.field)??t.defaultCsv2JsonOptions.delimiter.field,wrap:(null==(i=null==e?void 0:e.delimiter)?void 0:i.wrap)||t.defaultCsv2JsonOptions.delimiter.wrap,eol:(null==(n=null==e?void 0:e.delimiter)?void 0:n.eol)||t.defaultCsv2JsonOptions.delimiter.eol}}},u.validate=function(e,r,t){if(!e)throw new Error(`${t.cannotCallOn} ${e}.`);if(!r(e))throw new Error(t.dataCheckFailure);return!0},u.deepCopy=l,u.isStringRepresentation=function(e,r){const t=e[0],i=e[e.length-1];return t===r.delimiter.wrap&&i===r.delimiter.wrap},u.isDateRepresentation=function(e){return i.test(e)},u.computeSchemaDifferences=function(e,r){return f(e,r).concat(f(r,e))},u.isEmptyField=o,u.removeEmptyFields=function(e){return e.filter((e=>!o(e)))},u.getNCharacters=function(e,r,t){return e.substring(r,r+t)},u.unwind=function(e,t){const i=[];return e.forEach((e=>{!function(e,t,i){const n=(0,r.evaluatePath)(t,i);let s=l(t);Array.isArray(n)&&n.length?n.forEach((n=>{s=l(t),e.push((0,r.setPath)(s,i,n))})):Array.isArray(n)&&0===n.length?((0,r.setPath)(s,i,""),e.push(s)):e.push(s)}(i,e,t)})),i},u.isNumber=function(e){return!isNaN(Number(e))},u.isString=function(e){return"string"==typeof e},u.isObject=function(e){return"object"==typeof e},u.isNull=d,u.isUndefined=c,u.isError=function(e){return"[object Error]"===Object.prototype.toString.call(e)},u.arrayDifference=f,u.unique=function(e){return[...new Set(e)]},u.flatten=function(e){if(e.flat)return e.flat();if(e.length>n){let r=[];for(let t=0;t<e.length;t+=n)r=r.concat(...e.slice(t,t+n));return r}return e.reduce(((e,r)=>e.concat(r)),[])},u.isInvalid=function(e){return e===1/0||e===-1/0},u}function c(){if(l)return o;l=1;var t=o&&o.__createBinding||(Object.create?function(e,r,t,i){void 0===i&&(i=t);var n=Object.getOwnPropertyDescriptor(r,t);n&&!("get"in n?!r.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,i,n)}:function(e,r,t,i){void 0===i&&(i=t),e[i]=r[t]}),i=o&&o.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),n=o&&o.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&t(r,e,n);return i(r,e),r};Object.defineProperty(o,"__esModule",{value:!0}),o.Json2Csv=void 0;const a=e(),u=r(),c=s(),f=n(d());return o.Json2Csv=function(e){const r=new RegExp(e.delimiter.wrap,"g"),t=/\r?\n|\r/,i=e.parseValue&&"function"==typeof e.parseValue?e.parseValue:null,n=e.expandArrayObjects&&!e.unwindArrays,s={arrayIndexesAsKeys:e.arrayIndexesAsKeys,expandNestedObjects:e.expandNestedObjects,expandArrayObjects:n,ignoreEmptyArraysWhenExpanding:n,escapeNestedDots:!0};function l(r){if(0===r.length)return[];if(e.checkSchemaDifferences)return function(e){const r=e[0],t=e.slice(1);if(function(e,r){return r.reduce(((r,t)=>f.computeSchemaDifferences(e,t).length>0?r+1:r),0)}(r,t))throw new Error(c.errors.json2csv.notSameSchema);return r}(r);return f.unique(f.flatten(r))}function o(r){return e.excludeKeys?r.filter((r=>{for(const t of e.excludeKeys){const e=t instanceof RegExp?t:new RegExp(`^${t}`);if(t===r||r.match(e))return!1}return!0})):r}function d(r){return e.sortHeader&&"function"==typeof e.sortHeader?r.sort(e.sortHeader):e.sortHeader?r.sort():r}function p(){return e.keys?e.keys.map((r=>"object"==typeof r&&"field"in r?(e.fieldTitleMap[r.field]=r.title??r.field,r.field):r)):[]}function m(r){const t=e.keys?e.keys.flatMap((e=>"string"==typeof e?[]:(null==e?void 0:e.wildcardMatch)?e.field:[])):[],i=p(),n=function(e){return(0,u.deepKeysFromList)(e,s)}(r),a=l(n);if(e.keys){e.keys=i;const r=i.flatMap((e=>{if(!t.includes(e))return e;const r=[],i=new RegExp(`^${e}`);for(const t of a)(e===t||t.match(i))&&r.push(t);return r}));if(!e.unwindArrays){return d(o(r))}}return d(o(a))}function v(r,t=!1){if(e.unwindArrays){if(r.headerFields.forEach((e=>{r.records=f.unwind(r.records,e)})),r.headerFields=m(r.records),function(e){for(const r of e.records)for(const t of e.headerFields){const e=(0,a.evaluatePath)(r,t);if(Array.isArray(e))return!0}return!1}(r))return v(r,t);if(!t)return v(r,!0);if(e.keys){const e=p();r.headerFields=o(e)}return r}return r}function h(r){return r.recordString=r.records.map((t=>{const n=function(r,t){const i=[];return t.forEach((t=>{let n=(0,a.evaluatePath)(r,t);!f.isUndefined(e.emptyFieldValue)&&f.isEmptyField(n)?n=e.emptyFieldValue:e.expandArrayObjects&&Array.isArray(n)&&(n=function(r){const t=f.removeEmptyFields(r);if(!r.length||!t.length)return e.emptyFieldValue||"";if(1===t.length)return t[0];return r}(n)),i.push(n)})),i}(t,r.headerFields),s=n.map((e=>{e=O(e=g(e));let r=i?i(e,y):y(e);return r=b(r),r}));return s.join(e.delimiter.field)})).join(e.delimiter.eol),r}function y(r){const t=r instanceof Date;return null===r||Array.isArray(r)||"object"==typeof r&&!t?JSON.stringify(r):void 0===r?"undefined":t&&e.useDateIso8601Format?r.toISOString():e.useLocaleFormat?r.toLocaleString():r.toString()}function g(r){return e.trimFieldValues?Array.isArray(r)?r.map(g):"string"==typeof r?r.trim():r:r}function O(r){return e.preventCsvInjection?Array.isArray(r)?r.map(O):"string"!=typeof r||f.isNumber(r)?r:r.replace(/^[=+\-@\t\r]+/g,""):r}function b(i){const n=e.delimiter.wrap;return i.includes(e.delimiter.wrap)&&(i=i.replace(r,n+n)),(i.includes(e.delimiter.field)||i.includes(e.delimiter.wrap)||i.match(t)||e.wrapBooleans&&("true"===i||"false"===i))&&(i=n+i+n),i}return{convert:function(r){Array.isArray(r)||(r=[r]);const t=h(v({headerFields:m(r),records:r,header:"",recordString:""}));var i;return function(r){const t=r.header,i=r.recordString;return(e.excelBOM?c.excelBOM:"")+(e.prependHeader?t+e.delimiter.eol:"")+i}(function(r){const t=Object.keys(e.fieldTitleMap);return r.header=r.headerFields.map((function(r){let i=r;return t.includes(r)?i=e.fieldTitleMap[r]:e.escapeHeaderNestedDots||(i=i.replace(/\\\./g,".")),i})).join(e.delimiter.field),r}(function(r){return e.trimHeaderFields&&(r.headerFields=r.headerFields.map((e=>e.split(".").map((e=>e.trim())).join(".")))),r}((i=t,e.prependHeader&&(i.headerFields=i.headerFields.map((function(e){return b(e)}))),i))))}}},o}var f,p,m={};function v(){if(f)return m;f=1;var r=m&&m.__createBinding||(Object.create?function(e,r,t,i){void 0===i&&(i=t);var n=Object.getOwnPropertyDescriptor(r,t);n&&!("get"in n?!r.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,i,n)}:function(e,r,t,i){void 0===i&&(i=t),e[i]=r[t]}),t=m&&m.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),i=m&&m.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(i,e,n);return t(i,e),i};Object.defineProperty(m,"__esModule",{value:!0}),m.Csv2Json=void 0;const n=e(),a=s(),l=i(d());return m.Csv2Json=function(e){const r=new RegExp(e.delimiter.wrap+e.delimiter.wrap,"g"),t=new RegExp("^"+a.excelBOM),i=e.parseValue&&"function"==typeof e.parseValue?e.parseValue:JSON.parse;function s(r){return r=d(r),e.trimHeaderFields?r.split(".").map((e=>e.trim())).join("."):r}function o(r,t){return function(r){const t=function(r){try{if(l.isStringRepresentation(r,e)&&!l.isDateRepresentation(r))return r;const t=i(r);return Array.isArray(t)?t.map(u):t}catch(t){return t}}(r);if(!l.isError(t)&&!l.isInvalid(t))return t;if("undefined"===r)return;return r}(t[r.index])}function u(r){return e.trimFieldValues&&null!==r?r.trim():r}function d(r){const t=r[0],i=r.length-1,n=r[i];return t===e.delimiter.wrap&&n===e.delimiter.wrap?r.length<=2?"":r.substring(1,i):r}function c(t){return t.recordLines.reduce(((i,s)=>{s=s.map((t=>t=u(t=function(t){return t.replace(r,e.delimiter.wrap)}(t=d(t)))));const a=function(e,r){return e.reduce(((e,t)=>{const i=o(t,r);try{return(0,n.setPath)(e,t.value,i)}catch(s){return e}}),{})}(t.headerFields,s);return i.concat(a)}),[])}return{convert:function(r){var i;const n=function(r){let t=[];if(e.headerFields)t=e.headerFields.map(((e,r)=>({value:s(e),index:r})));else if(t=r[0].map(((e,r)=>({value:s(e),index:r}))),e.keys){const r=e.keys;t=t.filter((e=>r.includes(e.value)))}return{lines:r,headerFields:t,recordLines:[]}}(function(r){const t=[],i=r.length-1,n=e.delimiter.eol.length,s={insideWrapDelimiter:!1,parsingValue:!0,justParsedDoubleQuote:!1,startIndex:0};let a,o,u,d,c=[],f=0;for(;f<r.length;){if(a=r[f],o=f?r[f-1]:"",u=f<i?r[f+1]:"",d=l.getNCharacters(r,f,n),(d!==e.delimiter.eol||s.insideWrapDelimiter)&&f!==i||o!==e.delimiter.field)if(f===i&&a===e.delimiter.field){const e=r.substring(s.startIndex,f);c.push(e),c.push(""),t.push(c)}else if(f===i||d===e.delimiter.eol&&(!s.insideWrapDelimiter||s.insideWrapDelimiter&&o===e.delimiter.wrap&&!s.justParsedDoubleQuote)){const a=f!==i||o===e.delimiter.wrap?f:void 0;c.push(r.substring(s.startIndex,a)),t.push(c),c=[],s.startIndex=f+n,s.parsingValue=!0,s.insideWrapDelimiter=u===e.delimiter.wrap}else if(a!==e.delimiter.wrap||o!==e.delimiter.field||s.insideWrapDelimiter||s.parsingValue)if(o===e.delimiter.field&&a===e.delimiter.wrap&&u===e.delimiter.eol)c.push(r.substring(s.startIndex,f-1)),s.startIndex=f,s.parsingValue=!0,s.insideWrapDelimiter=!0,s.justParsedDoubleQuote=!0,f+=1;else if((o!==e.delimiter.wrap||s.justParsedDoubleQuote&&o===e.delimiter.wrap)&&a===e.delimiter.wrap&&l.getNCharacters(r,f+1,n)===e.delimiter.eol)s.insideWrapDelimiter=!1,s.parsingValue=!1;else if(a!==e.delimiter.wrap||0!==f&&(l.getNCharacters(r,f-n,n)!==e.delimiter.eol||s.insideWrapDelimiter))if(a===e.delimiter.wrap&&u===e.delimiter.field&&s.insideWrapDelimiter)c.push(r.substring(s.startIndex,f+1)),s.startIndex=f+2,s.insideWrapDelimiter=!1,s.parsingValue=!1;else if(a===e.delimiter.wrap&&o===e.delimiter.field&&!s.insideWrapDelimiter&&s.parsingValue)c.push(r.substring(s.startIndex,f-1)),s.insideWrapDelimiter=!0,s.parsingValue=!0,s.startIndex=f;else{if(a===e.delimiter.wrap&&u===e.delimiter.wrap&&f!==s.startIndex){f+=2,s.justParsedDoubleQuote=!0;continue}a===e.delimiter.field&&o!==e.delimiter.wrap&&u!==e.delimiter.wrap&&!s.insideWrapDelimiter&&s.parsingValue?(c.push(r.substring(s.startIndex,f)),s.startIndex=f+1):a!==e.delimiter.field||o!==e.delimiter.wrap||u===e.delimiter.wrap||s.parsingValue||(s.insideWrapDelimiter=!1,s.parsingValue=!0,s.startIndex=f+1)}else s.insideWrapDelimiter=!0,s.parsingValue=!0,s.startIndex=f;else s.startIndex=f,s.insideWrapDelimiter=!0,s.parsingValue=!0,l.getNCharacters(r,f+1,n)===e.delimiter.eol&&(f+=e.delimiter.eol.length+1);else d===e.delimiter.eol&&s.startIndex===f||a===e.delimiter.field?c.push(""):c.push(r.substring(s.startIndex)),c.push(""),t.push(c),c=[],s.startIndex=f+n,s.parsingValue=!0,s.insideWrapDelimiter=u===e.delimiter.wrap;f++,s.justParsedDoubleQuote=!1}return t}((i=r,e.excelBOM?i.replace(t,""):i)));var a;return c((a=n,e.headerFields?a.recordLines=a.lines:a.recordLines=a.lines.splice(1),a))}}},m}var h=function(){if(p)return i;p=1,Object.defineProperty(i,"__esModule",{value:!0}),i.csv2json=i.json2csv=void 0;const e=s(),r=c(),t=v(),n=d();return i.json2csv=function(t,i){const s=(0,n.buildJ2COptions)(i??{});return(0,n.validate)(t,n.isObject,e.errors.json2csv),(0,r.Json2Csv)(s).convert(t)},i.csv2json=function(r,i){const s=(0,n.buildC2JOptions)(i??{});return(0,n.validate)(r,n.isString,e.errors.csv2json),(0,t.Csv2Json)(s).convert(r)},i}();export{h as c};
